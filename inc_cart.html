<div id="row">
  <h4 class="text-info"><a class="text-muted" href="main.html"><i class="far fa-id-badge"></i></a>
    <i class="fas fa-chevron-right text-secondary"></i> <a href="main.html?v=buyproduct"><i
        class="fas fa-shopping-cart text-success"></i></a> <i class="fas fa-chevron-right text-secondary"></i> <i
      class="fas fa-shopping-basket"></i> Bakul
    Pembelian Saya
  </h4>
</div>
<hr>
<p class="lead"">Berikut adalah produk-produk yang anda telah pesan. Sila pastikan semua produk dan kuantiti adalah tepat sebelum membuat sebarang pembayaran.</p>

<table class=" table table-bordered table-striped table-hover">
  <thead>
    <tr>
      <th scope="col" class="text-center align-middle" style="width: 5%">#</th>
      <th scope="col" class="text-center align-middle" style="width: 55%">Produk Dipesan</th>
      <th scope="col" class="text-center align-middle" style="width: 10%">Harga per karton</th>
      <th scope="col" class="text-center align-middle" style="width: 20%">Kuantiti Dipesan</th>
      <th scope="col" class="text-center align-middle" style="width: 10%">Jumlah (MYR)</th>
    </tr>
  </thead>
  <tbody id="tableBody">
    <tr>
      <th scope="row">1</th>
      <td>Minyak Morhabshi - 120ml</td>
      <td class="text-right">148.00</td>
      <td class="text-center">
        <div class="row">
          <div class="col-sm-5"><a class="btn btn-outline-dark btn-sm">-</a></div>
          <div class="col-sm-2 text-center">20</div>
          <div class="col-sm-5"><a class="btn btn-outline-dark btn-sm">+</a></div>
        </div>
      </td>
      <td class="text-right">2960.00</td>
    </tr>
    <tr>
      <th scope="row">2</th>
      <td>Premium Stevia Morhabshi - 60ml</td>
      <td class="text-right">148.00</td>
      <td class="text-center">
        <div class="row">
          <div class="col-sm-5"><a class="btn btn-outline-dark btn-sm">-</a></div>
          <div class="col-sm-2 text-center">20</div>
          <div class="col-sm-5"><a class="btn btn-outline-dark btn-sm">+</a></div>
        </div>
      </td>
      <td class="text-right">2960.00</td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td colspan="4" class="text-right">Jumlah Perlu Dibayar:</td>
      <td class="text-right"><i class="lead font-weight-bold text-success">8721.00</i></td>
    </tr>
  </tfoot>
  </table>

  <button class="btn btn-outline-dark btn-lg btn-block">Batalkan semua pesanan.</button>
  <hr>
  <button class="btn btn-info btn-lg btn-block">Bayar melalui deposit tunai/cek/bank draft.</button>
  <hr>
  <button class="btn btn-secondary btn-lg btn-block">Bayar sekarang menggunakan <span> </span><img
      src="img/upay-logo-web.png" width="35px" /></button>
  <hr>
  <button class="btn btn-warning btn-lg btn-block">Bayar sekarang menggunakan <span> </span><img src="img/paypal.png"
      width="62px" /></button>

  <script>
    console.log("Hello from " + window.location.pathname + window.location.search);

    firebase.auth().onAuthStateChanged(function (user) {
      if (user) {

        var mainNode = document.getElementById("tableBody");
        var i = 0;

        while (mainNode.firstChild) {
          mainNode.removeChild(mainNode.firstChild);
        }

        // Listen for new items added to cart
        db.collection('agents/' + user.email + '/incart/').doc('cart')
          .onSnapshot(function (cartItems) {
            if (cartItems.data().line_items) {
              console.log(i+1);
              console.log(cartItems.data().line_items);
              var allItems = cartItems.data().line_items;

              allItems.forEach(function (eachItem) {
                console.log("Current eachItem:");
                console.log(eachItem);
                var row = document.createElement('tr');

                var cellNum = document.createElement('th');
                cellNum.appendChild(document.createTextNode(i+1));
                cellNum.setAttribute('scope', 'row');

                var cellItem = document.createElement('td');
                cellItem.appendChild(document.createTextNode(eachItem.item));

                var cellUnitPrice = document.createElement('td');
                cellUnitPrice.appendChild(document.createTextNode('3'+'.00'));
                cellUnitPrice.classList.add("text-right");
                cellUnitPrice.classList.add("align-middle");

                var cellQuantity = document.createElement('td');
                cellQuantity.innerHTML = '<div class="row">'+
                                         '<div class="col-sm-5"><a class="btn btn-outline-dark btn-sm">-</a></div>'+
                                         '<div class="col-sm-2 text-center">'+eachItem.quantity+'</div>'+
                                         '<div class="col-sm-5"><a class="btn btn-outline-dark btn-sm">+</a></div>'+
                                         '</div>';
                cellQuantity.classList.add("text-center");
                cellQuantity.classList.add("align-middle");

                var cellTotal = document.createElement('td');
                cellTotal.appendChild(document.createTextNode('13'+'.00'));
                cellTotal.classList.add("text-right");
                cellTotal.classList.add("align-middle");

                row.appendChild(cellNum);
                row.appendChild(cellItem);
                row.appendChild(cellUnitPrice);
                row.appendChild(cellQuantity);
                row.appendChild(cellTotal);
                mainNode.appendChild(row);
                i++;
              }) // end allItems.forEach
            } // end if line_items
          }); // end items in cart
      } else {
        console.log("User NOT signed in.");
      }
    });

  </script>